<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard — SmartCity</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 min-h-screen">
  <div class="max-w-6xl mx-auto p-6">
    <header class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-teal-500 to-cyan-500 flex items-center justify-center text-white font-bold">SC</div>
        <div>
          <h1 class="text-xl font-semibold">SmartCity Electricity Dashboard</h1>
          <p class="text-sm text-slate-500">Recharge and view history</p>
        </div>
      </div>
      <button id="logoutBtn" class="px-4 py-2 rounded-lg border">Logout</button>
    </header>

    <div class="bg-white p-6 rounded-xl shadow">
      <h3 class="text-lg font-semibold mb-3">Recharge Meter</h3>
      <form id="rechargeForm" class="space-y-3">
        <input id="amount" type="number" min="1" placeholder="Enter amount ₹" required class="w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-400" />
        <button class="w-full py-3 bg-gradient-to-r from-teal-500 to-cyan-500 text-white rounded-lg font-semibold">Recharge</button>
      </form>
      <div id="rechargeMsg" class="mt-4 text-sm text-green-600"></div>
    </div>

    <div class="bg-white mt-6 p-6 rounded-xl shadow">
      <h3 class="text-lg font-semibold mb-3">Transaction History</h3>
      <div id="txList" class="text-sm text-slate-600"></div>
    </div>
  </div>

  <script>
    const session = localStorage.getItem('sc_user');
    const verified = localStorage.getItem('meter_verified');
    if(!session || !verified) location.href = "index.html";

    const user = JSON.parse(session);
    const TX_KEY = 'sc_recharges';
    let txns = JSON.parse(localStorage.getItem(TX_KEY) || '[]');
    const txList = document.getElementById('txList');
    const msg = document.getElementById('rechargeMsg');

    function renderTx(){
      const myTx = txns.filter(t => t.customerId === user.customerId);
      if(myTx.length === 0){ txList.innerHTML = "No previous transactions."; return; }
      txList.innerHTML = myTx.slice().reverse().map(t => `
        <div class="border-b py-2 flex justify-between">
          <span>₹${t.amount}</span>
          <span class="text-slate-500 text-xs">${new Date(t.date).toLocaleString()}</span>
        </div>`).join('');
    }
    renderTx();

    document.getElementById('rechargeForm').addEventListener('submit', e=>{
      e.preventDefault();
      const amount = +document.getElementById('amount').value;
      if(amount<=0){ msg.textContent = 'Enter valid amount'; return; }
      const tx = { id: Date.now(), customerId: user.customerId, amount, date: new Date().toISOString() };
      txns.push(tx);
      localStorage.setItem(TX_KEY, JSON.stringify(txns));
      renderTx();
      msg.textContent = `Recharge successful for ₹${amount}`;
      setTimeout(()=> msg.textContent='', 4000);
    });

    document.getElementById('logoutBtn').addEventListener('click', ()=>{
      localStorage.clear();
      location.href = "index.html";
    });
  </script>
</body>
</html>
